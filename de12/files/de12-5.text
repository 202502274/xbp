from openai import OpenAI
from dotenv import load_dotenv
import os

#API
client = OpenAI(api_key)

def get_greeting(to, medium, role):
    """
    medium: "ãƒ¡ãƒ¼ãƒ«" ã¾ãŸã¯ "ãƒãƒ£ãƒƒãƒˆ"
    role: "ä¸Šå¸" / "å€‹äººå" ãªã©
    """
    # ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†å²
    if medium == "ãƒ¡ãƒ¼ãƒ«":
        greeting = "ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚"
    elif medium == "ãƒãƒ£ãƒƒãƒˆ" and role == "ä¸Šå¸":
        greeting = "ãŠç–²ã‚Œæ§˜ã§ã™"
    elif medium == "ãƒãƒ£ãƒƒãƒˆ":
        greeting = "ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™"
    else:
        greeting = "ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚"

    # åå‰ã«æ§˜ã‚’ä»˜ã‘ã‚‹ã‹èª¿æ•´
    if "æ§˜" not in to and not (role == "å€‹äººå"):
        to_formatted = f"{to} æ§˜"
    else:
        to_formatted = to

    return f"{to_formatted} {greeting}\n\n"
    
#ç´°ã‹ã„æŒ‡ç¤º
def generate_reply_ai(to, tone, medium, situation, details):
    prompt = f"""
    ä¸Šå¸ç­‰ã¸ã®ãƒ¡ãƒ¼ãƒ«ã€ãƒãƒ£ãƒƒãƒˆè¿”ä¿¡æ–‡ã‚’æ›¸ã„ã¦ã»ã—ã„ã§ã™ã€‚
    æ¬¡ã®æ¡ä»¶ã«åŸºã¥ã„ã¦ã€è‡ªç„¶ã§ç›¸æ‰‹ã«å¤±ç¤¼ã®ãªã„è¿”ä¿¡æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

    ã€æ¡ä»¶ã€‘
    - å®›å…ˆ: {to}
    - æ–‡ä½“: {tone}
    - é€ä¿¡æ–¹æ³•: {medium}
    - çŠ¶æ³: {situation}
    - è©³ç´°å†…å®¹: {details}

    ã€å‡ºåŠ›å½¢å¼ã€‘
    - ä»¶åï¼ˆãƒ¡ãƒ¼ãƒ«ã®å ´åˆã®ã¿ï¼‰
    - æœ¬æ–‡

    ã€ãã®ä»–ã€‘
    ãƒ¡ãƒ¼ãƒ«ã®å ´åˆã€ŒãŠç–²ã‚Œæ§˜ã§ã™ã€ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€ã®æ¬¡ã¯ä¸€è¡Œé–‹ã‘ã‚‹ã“ã¨
    åª’ä½“å•ã‚ãšä¸€æ–‡ã”ã¨ã«æ”¹è¡Œã™ã‚‹ã“ã¨ã€ä¸€è¡Œã¯é–‹ã‘ãªãã¦è‰¯ã„
    çŠ¶æ³ã€Œç¢ºèªã€ï¼šãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ã¨ã„ã†æ„å‘³åˆã„ã§ä½œæˆã—ã¦ãã ã•ã„
    æ–‡æœ«ã¯åŸºæœ¬çš„ã«ã€Œä»¥ä¸Šã€ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚ã€ã¨ã™ã‚‹ã“ã¨
    """

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.7,
    )

    return response.choices[0].message.content.strip()

# --- å®Ÿè¡Œéƒ¨åˆ† ---
if __name__ == "__main__":
    print("ğŸ“§ è‡ªå‹•è¿”ä¿¡æ–‡AIã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼")
    print("------------------------------")

    to = input("é€ä¿¡å…ˆï¼ˆä¾‹ï¼šå€‹äººåã€ä¸Šå¸ã€åŒåƒšãªã©ï¼‰ï¼š")
    tone = input("æ–‡ä½“ï¼ˆä¸å¯§ï¼ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼ãƒ“ã‚¸ãƒã‚¹ï¼‰ï¼š")
    medium = input("åª’ä½“ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼ãƒãƒ£ãƒƒãƒˆï¼‰ï¼š")
    situation = input("çŠ¶æ³ï¼ˆãŠç¤¼ï¼è¬ç½ªï¼ç¢ºèªï¼è¿”ä¿¡é…ã‚Œï¼ãã®ä»–ï¼‰ï¼š")
    details = input("è©³ç´°å†…å®¹ï¼ˆè¿”ä¿¡ã§ä¼ãˆãŸã„ã“ã¨ã‚’è‡ªç”±ã«å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰ï¼š")

    print("\nç”Ÿæˆä¸­...\n")
    reply = generate_reply_ai(to, tone, medium, situation, details)

    print("âœ… --- ç”Ÿæˆã•ã‚ŒãŸè¿”ä¿¡æ–‡ --- âœ…\n")
    print(reply)